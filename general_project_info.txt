ğŸ® WageWars - Optimized Project Structure
ğŸ“ Project Structure
wagewars/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ deploy.yml
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                    # FastAPI app entry point
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py               # Dependencies (auth, db)
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # Login, register, JWT
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users.py          # User profile, stats
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ matches.py        # Match CRUD, verification
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ matchmaking.py    # Queue, finding opponents
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ payments.py       # M-Pesa integration
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tournaments.py    # Tournament management
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ notifications.py  # Push notifications
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py          # WebSocket handlers
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py             # Settings using Pydantic
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py           # JWT, password hashing
â”‚   â”‚   â”‚   â””â”€â”€ database.py           # SQLAlchemy setup
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py               # Base SQLAlchemy model
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py               # User, PlayerStats models
â”‚   â”‚   â”‚   â”œâ”€â”€ match.py              # Match, MatchmakingQueue
â”‚   â”‚   â”‚   â”œâ”€â”€ tournament.py         # Tournament models
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction.py        # Payment models
â”‚   â”‚   â”‚   â””â”€â”€ notification.py       # Notification model
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py               # Pydantic schemas
â”‚   â”‚   â”‚   â”œâ”€â”€ match.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tournament.py
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction.py
â”‚   â”‚   â”‚   â””â”€â”€ notification.py
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py               # Auth business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ matchmaking.py        # Matchmaking algorithm
â”‚   â”‚   â”‚   â”œâ”€â”€ match.py              # Match management
â”‚   â”‚   â”‚   â”œâ”€â”€ mpesa.py              # M-Pesa Daraja API
â”‚   â”‚   â”‚   â”œâ”€â”€ cod_api.py            # COD API integration
â”‚   â”‚   â”‚   â””â”€â”€ notifications.py      # Push/SMS services
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ validators.py
â”‚   â”‚   â”‚   â””â”€â”€ helpers.py
â”‚   â”‚   â””â”€â”€ tests/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ conftest.py           # Pytest fixtures
â”‚   â”‚       â”œâ”€â”€ test_auth.py
â”‚   â”‚       â”œâ”€â”€ test_matches.py
â”‚   â”‚       â””â”€â”€ test_payments.py
â”‚   â”œâ”€â”€ alembic/                      # Database migrations
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â””â”€â”€ versions/
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ pytest.ini
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                   # Reusable UI components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Toast.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ matches/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WagerSelector.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MatchmakingQueue.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ActiveMatch.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MatchVerification.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MatchHistory.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentModal.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WalletBalance.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TransactionHistory.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tournaments/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TournamentCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TournamentBracket.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TournamentStats.tsx
â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚       â”œâ”€â”€ UserProfile.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ PlayerStats.tsx
â”‚   â”‚   â”‚       â””â”€â”€ Leaderboard.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ _app.tsx              # App wrapper with providers
â”‚   â”‚   â”‚   â”œâ”€â”€ _document.tsx         # Custom document
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx             # Landing page
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.tsx         # Main dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ matches/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ find.tsx          # Matchmaking
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ active.tsx        # Active matches
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ history.tsx       # Match history
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id].tsx          # Match details
â”‚   â”‚   â”‚   â”œâ”€â”€ tournaments/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx         # Tournament list
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id].tsx          # Tournament details
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.tsx         # User profile
â”‚   â”‚   â”‚   â”œâ”€â”€ leaderboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ wallet.tsx
â”‚   â”‚   â”‚   â””â”€â”€ api/                  # API routes (minimal usage)
â”‚   â”‚   â”‚       â””â”€â”€ webhook.ts        # M-Pesa webhooks
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                # Axios client with interceptors
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts               # Auth utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket.ts          # WebSocket client
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.ts            # Local storage utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ validators.ts         # Form validation schemas
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts              # General utilities
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useMatchmaking.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useApi.ts             # React Query hooks
â”‚   â”‚   â”‚   â””â”€â”€ useNotifications.ts
â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ WebSocketContext.tsx
â”‚   â”‚   â”‚   â””â”€â”€ NotificationContext.tsx
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ match.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ tournament.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction.ts
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â”œâ”€â”€ globals.css
â”‚   â”‚       â””â”€â”€ components.css
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â”œâ”€â”€ sw.js                     # Service worker for PWA
â”‚   â”‚   â””â”€â”€ icons/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ next.config.js
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env.local.example
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
ğŸ—„ï¸ Optimized Database Schema
sql-- Users table with essential fields
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(15) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    wallet_balance DECIMAL(10,2) DEFAULT 0.00,
    cod_username VARCHAR(50),
    profile_image_url VARCHAR(255),
    is_verified BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Player statistics
CREATE TABLE player_stats (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    total_matches INTEGER DEFAULT 0,
    wins INTEGER DEFAULT 0,
    losses INTEGER DEFAULT 0,
    total_wagered DECIMAL(10,2) DEFAULT 0.00,
    total_winnings DECIMAL(10,2) DEFAULT 0.00,
    current_rank INTEGER DEFAULT 1000,
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Matches with simplified structure
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    player1_id INTEGER REFERENCES users(id),
    player2_id INTEGER REFERENCES users(id),
    wager_amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending', -- pending, active, completed, disputed
    winner_id INTEGER REFERENCES users(id),
    player1_confirmed BOOLEAN DEFAULT FALSE,
    player2_confirmed BOOLEAN DEFAULT FALSE,
    cod_match_data JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    started_at TIMESTAMP,
    completed_at TIMESTAMP
);

-- Simplified transactions
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    match_id INTEGER REFERENCES matches(id),
    type VARCHAR(20) NOT NULL, -- deposit, wager_hold, wager_win, withdrawal
    amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending', -- pending, completed, failed
    mpesa_reference VARCHAR(100),
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Matchmaking queue
CREATE TABLE matchmaking_queue (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    wager_amount DECIMAL(10,2) NOT NULL,
    skill_range_min INTEGER DEFAULT 900,
    skill_range_max INTEGER DEFAULT 1100,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id)
);

-- Notifications
CREATE TABLE notifications (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL,
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tournaments (simplified)
CREATE TABLE tournaments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    entry_fee DECIMAL(10,2) NOT NULL,
    max_participants INTEGER NOT NULL,
    current_participants INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'upcoming',
    start_date TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tournament participants
CREATE TABLE tournament_participants (
    id SERIAL PRIMARY KEY,
    tournament_id INTEGER REFERENCES tournaments(id) ON DELETE CASCADE,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    eliminated BOOLEAN DEFAULT FALSE,
    joined_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(tournament_id, user_id)
);

-- Essential indexes
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_matches_status ON matches(status);
CREATE INDEX idx_matches_players ON matches(player1_id, player2_id);
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_matchmaking_queue_wager ON matchmaking_queue(wager_amount);
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read);
ğŸ”§ Key Technologies & Dependencies
Backend (FastAPI)
txtfastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
alembic==1.12.1
psycopg2-binary==2.9.7
pydantic==2.5.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
websockets==12.0
httpx==0.25.2
redis==5.0.1
celery==5.3.4
python-dotenv==1.0.0
pytest==7.4.3
pytest-asyncio==0.21.1
Frontend (Next.js TypeScript)
json{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.2.0",
    "@types/node": "^20.8.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "tailwindcss": "^3.3.0",
    "axios": "^1.6.0",
    "@tanstack/react-query": "^5.0.0",
    "react-hook-form": "^7.47.0",
    "@hookform/resolvers": "^3.3.0",
    "zod": "^3.22.0",
    "socket.io-client": "^4.7.0",
    "react-hot-toast": "^2.4.0",
    "next-pwa": "^5.6.0",
    "lucide-react": "^0.294.0"
  },
  "devDependencies": {
    "eslint": "^8.52.0",
    "eslint-config-next": "^14.0.0",
    "@types/socket.io-client": "^3.0.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0"
  }
}
ğŸ—ï¸ Development Workflow
1. Backend Setup
bashcd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
alembic upgrade head
uvicorn app.main:app --reload
2. Frontend Setup
bashcd frontend
npm install
npm run dev
3. Database Setup
bashdocker run --name wagewars-db -e POSTGRES_PASSWORD=password -p 5432:5432 -d postgres:15
ğŸ“± Progressive Web App Features

Service Worker: Offline support for basic functionality
Push Notifications: Match found, payment received, etc.
App-like Experience: Install on mobile devices
Responsive Design: Mobile-first approach

ğŸ” Security Considerations

JWT Authentication: Access and refresh tokens
Password Hashing: bcrypt for secure password storage
Input Validation: Pydantic schemas on backend, Zod on frontend
CORS Configuration: Proper CORS setup for production
Rate Limiting: Prevent API abuse
SQL Injection Prevention: SQLAlchemy ORM protection

ğŸš€ Deployment Strategy
Production Stack

Frontend: Vercel or Netlify
Backend: Railway, DigitalOcean App Platform, or AWS ECS
Database: Managed PostgreSQL (AWS RDS, DigitalOcean Managed Database)
Redis: For caching and WebSocket scaling
CDN: Cloudflare for static assets

Environment Variables
bash# Backend
DATABASE_URL=postgresql://user:pass@localhost/wagewars
SECRET_KEY=your-secret-key
MPESA_CONSUMER_KEY=your-mpesa-key
MPESA_CONSUMER_SECRET=your-mpesa-secret
COD_API_KEY=your-cod-api-key
REDIS_URL=redis://localhost:6379

# Frontend
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws